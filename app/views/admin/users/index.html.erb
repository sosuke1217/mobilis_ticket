<div class="container-lg my-5">
  <div class="card shadow-sm">
    <div class="card-header bg-dark text-white">
      <h2 class="h5 mb-0">👥 ユーザー一覧（管理者用）</h2>
    </div>

    <div class="card-body">
      <!-- 🔍 検索フォーム -->
      <%= search_form_for @q, url: admin_users_path, method: :get, html: { class: "row g-3 align-items-end mb-4" } do |f| %>
        <div class="col-md-4">
          <div class="input-group">
            <%= f.search_field :name_cont, class: "form-control", placeholder: "名前で検索" %>
            <button class="btn btn-primary" type="submit">検索</button>
            <% if params[:q].present? %>
              <%= link_to "リセット", admin_users_path, class: "btn btn-outline-secondary" %>
            <% end %>
          </div>
        </div>
        <div class="col-md-auto text-muted small">
          全 <%= @users.total_count %> 件
        </div>
      <% end %>

      <!-- 👤 ユーザー一覧テーブル -->
      <div class="table-responsive">
        <table class="table table-hover table-striped align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th>ID</th>
              <th>名前</th>
              <th>LINE ID</th>
              <th>登録日</th>
              <th>残チケット</th>
              <th>最終来店日</th>
              <th>残額合計</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <% @users.each do |user| %>
              <tr>
                <td><%= user.id %></td>
                <td>
                  <% if user.name.present? %>
                    <%= link_to user.name, admin_user_path(user), class: "fw-semibold" %>
                  <% else %>
                    <span class="text-muted fst-italic">未登録</span>
                  <% end %>
                </td>
                <td><%= user.line_user_id || content_tag(:span, "未連携", class: "text-muted") %></td>
                <td><%= l(user.created_at.to_date) %></td>
                <td><%= user.active_ticket_count %> 回</td>
                <td><%= user.last_usage_date&.strftime("%Y/%m/%d") || "未使用" %></td>
                <td><%= number_to_currency(user.remaining_ticket_value, unit: "¥", precision: 0) %></td>
                <td>
                  <% if user.name.present? %>
                    <%= link_to "チケット管理", admin_user_ticket_management_path(user), class: "btn btn-sm btn-outline-primary" %>
                  <% else %>
                    <span class="text-muted fst-italic">未登録</span>
                  <% end %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
      <div class="mt-3">
        <%= paginate @users %>
      </div>
    </div>
  </div>
</div>
